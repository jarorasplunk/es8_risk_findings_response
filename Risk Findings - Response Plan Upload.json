{
    "blockly": false,
    "blockly_xml": "<xml></xml>",
    "category": "Uncategorized",
    "coa": {
        "data": {
            "customCode": "\"\"\"\n\n\"\"\"\n\n\nimport phantom.rules as phantom\nimport json\nfrom datetime import datetime, timedelta\n\n\n@phantom.playbook_block()\ndef on_start(container):\n    phantom.debug('on_start() called')\n\n    # call 'create_response_plan_json' block\n    create_response_plan_json(container=container)\n\n    return\n\n@phantom.playbook_block()\ndef create_response_plan_json(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, loop_state_json=None, **kwargs):\n    phantom.debug(\"create_response_plan_json() called\")\n\n    create_response_plan_json__risk_findings_response_json_body = None\n\n    ################################################################################\n    ## Custom Code Start\n    ################################################################################\n\n    # Write your custom code here...\n    \n    var_true = True\n    var_false = False\n    var_0 = 0\n    var_1 = 1\n    var_2 = 2\n    var_3 = 3\n    \n    # Create JSON body for \"Risk Notable Investigation\" response plan\n    \n    create_response_plan_json__risk_findings_response_json_body = {\n        \"name\": \"Risk Findings Response\",\n        \"version\": \"1\",\n        \"is_default\": var_false,\n        \"description\": \"A series of tasks for enrichment, investigation and response to incidents created by Risk Notables\",\n        \"template_status\": \"published\",\n        \"phases\": [\n            {\n                \"name\": \"Preprocess\",\n                \"order\": var_1,\n                \"tasks\": [\n                    {\n                        \"name\": \"Prepare the investigation\",\n                        \"order\": var_1,\n                        \"description\": \"In the right hand side panel of this investigation:\\n1. Update the status of this investigation from New to In-Progress\\n2. Assign the owner of this investigation\\n3. Optional: Select a disposition, if it is applicable at this stage.\\n\\nAlternatively, run the playbook (below), which will:\\n1. Send you an input prompt to Assign the incident to yourself or to another analyst\\n2. Change the status from New to In-Progress\",\n                        \"suggestions\": {\n                            \"actions\": [],\n                            \"searches\": [],\n                            \"playbooks\": [\n                                {\n                                    \"name\": \"Risk Finding - Prepare Investigation\",\n                                    \"scope\": \"all\",\n                                    \"description\": \"Risk Finding - Prepare Investigation\",\n                                    \"playbook_id\": \"es8_risk_findings_response/Risk Finding - Prepare Investigation\",\n                                    \"last_job_id\": var_0\n                                }\n                            ]\n                        },\n                        \"is_note_required\": var_false\n                    },\n                    {\n                        \"name\": \"Gather related findings\",\n                        \"order\": var_2,\n                        \"description\": \"Gather related individual findings and intermediate findings that are part of this investigation.\\nRun the playbook (below) which will capture the related findings from the Analyst Queue and will provide you options to close the individual alerts/findings in the Analyst Queue, while you continue to work on this investigation.\",\n                        \"suggestions\": {\n                            \"actions\": [],\n                            \"searches\": [],\n                            \"playbooks\": [\n                                {\n                                    \"name\": \"Risk Finding - Related Findings\",\n                                    \"scope\": \"all\",\n                                    \"description\": \"Risk Finding - Related Findings\",\n                                    \"playbook_id\": \"es8_risk_findings_response/Risk Finding - Related Findings\",\n                                    \"last_job_id\": var_0\n                                }\n                            ]\n                        },\n                        \"is_note_required\": var_false\n                    },\n                    {\n                        \"name\": \"Enrich findings\",\n                        \"order\": var_3,\n                        \"description\": \"This step will extract key entities, indicators and behaviour from the included findings in this investigation and will enrich their context using SOAR automation workflows. The enriched information for all applicable findings will be presented here in the form of notes.\",\n                        \"suggestions\": {\n                            \"actions\": [],\n                            \"searches\": [],\n                            \"playbooks\": [\n                                {\n                                    \"name\": \"Risk Finding - Dispatch Enrichment Playbooks\",\n                                    \"scope\": \"all\",\n                                    \"description\": \"Risk Finding - Dispatch Enrichment Playbooks\",\n                                    \"playbook_id\": \"es8_risk_findings_response/Risk Finding - Dispatch Enrichment Playbooks\",\n                                    \"last_job_id\": var_0\n                                }\n                            ]\n                        },\n                        \"is_note_required\": var_false\n                    },\n                ]\n            },\n            {\n                \"name\": \"Investigate\",\n                \"order\": var_1,\n                \"tasks\": [\n                    {\n                        \"name\": \"Investigate findings\",\n                        \"order\": var_1,\n                        \"description\": \"Investigate individual findings in this Risk Investigation. An autoamted playbook has trigerred and captured additonal details about the individal findings, please review them and conduct further investigation.\",\n                        \"suggestions\": {\n                            \"actions\": [],\n                            \"searches\": [],\n                            \"playbooks\": [\n                                {\n                                    \"name\": \"Risk Finding - Investigate Findings\",\n                                    \"scope\": \"all\",\n                                    \"description\": \"Risk Finding - Investigate Findings\",\n                                    \"playbook_id\": \"es8_risk_findings_response/Risk Finding - Investigate Findings\",\n                                    \"last_job_id\": var_0\n                                }\n                            ]\n                        },\n                        \"is_note_required\": var_false\n                    },\n                    {\n                        \"name\": \"Hunt Indicators\",\n                        \"order\": var_2,\n                        \"description\": \"Hunt for the involved indicators from this Risk Finding across Splunk logs. Gather evidence of presence of these indicators.\",\n                        \"suggestions\": {\n                            \"actions\": [],\n                            \"searches\": [],\n                            \"playbooks\": [\n                                {\n                                    \"name\": \"Risk Finding - Hunt Indicators\",\n                                    \"scope\": \"all\",\n                                    \"description\": \"Risk Finding - Hunt Indicators\",\n                                    \"playbook_id\": \"es8_risk_findings_response/Risk Finding - Hunt Indicators\",\n                                    \"last_job_id\": var_0\n                                }\n                            ]\n                        },\n                        \"is_note_required\": var_false\n                    },\n                    {\n                        \"name\": \"Optional: Investigation notes\",\n                        \"order\": var_3,\n                        \"description\": \"Add any additional investigation details performed outside of this response plan. Create manual notes and attach files etc.\",\n                        \"suggestions\": {\n                            \"actions\": [],\n                            \"searches\": [],\n                            \"playbooks\": []\n                        },\n                        \"is_note_required\": var_false\n                    },\n                ]\n            },\n            {\n                \"name\": \"Containment\",\n                \"order\": var_1,\n                \"tasks\": [\n                    {\n                        \"name\": \"Protect Users\",\n                        \"order\": var_1,\n                        \"description\": \"Execute comtainment actions to protect users.\\n- Temporariliy disable users\\n- Reset Users password\\n- Notify users about incident\\n- Create blocklists.\",\n                        \"suggestions\": {\n                            \"actions\": [],\n                            \"searches\": [],\n                            \"playbooks\": []\n                        },\n                        \"is_note_required\": var_false\n                    },\n                    {\n                        \"name\": \"Protect Assets\",\n                        \"order\": var_2,\n                        \"description\": \"Execute comtainment actions to protect systems and assets.\\n- Temporariliy isolate devices\\n- Temporarily shutdown devices\\n- Create tickets for re-imaging machines\\n- Create blocklists.\",\n                        \"suggestions\": {\n                            \"actions\": [],\n                            \"searches\": [],\n                            \"playbooks\": []\n                        },\n                        \"is_note_required\": var_false\n                    },\n                    {\n                        \"name\": \"Post Incident Activities\",\n                        \"order\": var_3,\n                        \"description\": \"Create a report for this investigation for audit and review. Gather lessons learned and document them. Apply additional security practices to prevent this incident from happening.\",\n                        \"suggestions\": {\n                            \"actions\": [],\n                            \"searches\": [],\n                            \"playbooks\": []\n                        },\n                        \"is_note_required\": var_false\n                    },\n                ]\n            }\n        ]\n    }\n    \n    \n    convert_json_risk_findings_response = json.dumps(create_response_plan_json__risk_findings_response_json_body)\n    phantom.debug(convert_json_risk_findings_response)\n    create_response_plan_json__risk_findings_response_json_body = convert_json_risk_findings_response\n\n    ################################################################################\n    ## Custom Code End\n    ################################################################################\n\n    phantom.save_block_result(key=\"create_response_plan_json:risk_findings_response_json_body\", value=json.dumps(create_response_plan_json__risk_findings_response_json_body))\n\n    post_data_1(container=container)\n\n    return\n\n\n@phantom.playbook_block()\ndef post_data_1(action=None, success=None, container=None, results=None, handle=None, filtered_artifacts=None, filtered_results=None, custom_function=None, loop_state_json=None, **kwargs):\n    phantom.debug(\"post_data_1() called\")\n\n    # phantom.debug('Action: {0} {1}'.format(action['name'], ('SUCCEEDED' if success else 'FAILED')))\n\n    create_response_plan_json__risk_findings_response_json_body = json.loads(_ if (_ := phantom.get_run_data(key=\"create_response_plan_json:risk_findings_response_json_body\")) != \"\" else \"null\")  # pylint: disable=used-before-assignment\n\n    parameters = []\n\n    parameters.append({\n        \"body\": create_response_plan_json__risk_findings_response_json_body,\n        \"location\": \"/v1/responseplans\",\n    })\n\n    ################################################################################\n    ## Custom Code Start\n    ################################################################################\n\n    # Write your custom code here...\n\n    ################################################################################\n    ## Custom Code End\n    ################################################################################\n\n    phantom.act(\"post data\", parameters=parameters, name=\"post_data_1\", assets=[\"es\"])\n\n    return\n\n\n@phantom.playbook_block()\ndef on_finish(container, summary):\n    phantom.debug(\"on_finish() called\")\n\n    ################################################################################\n    ## Custom Code Start\n    ################################################################################\n\n    # Write your custom code here...\n\n    ################################################################################\n    ## Custom Code End\n    ################################################################################\n\n    return",
            "description": "",
            "edges": [],
            "hash": "8a4b1a57cdefeb0185dd29a8a0a9a585dfcd09e0",
            "nodes": {},
            "notes": ""
        },
        "input_spec": null,
        "output_spec": null,
        "playbook_trigger": "artifact_created",
        "playbook_type": "es",
        "python_version": "3.9",
        "schema": "5.0.20",
        "version": "6.4.1.342"
    },
    "create_time": "2025-06-06T02:56:33+00:00",
    "draft_mode": false,
    "labels": [
        "es_soar_integration"
    ],
    "tags": []
}